
# Backend (C#, .NET, ASP.NET Core) ‚Äî Middle

### üéØ –ö–∞–∫ —Ä–∞—Å—Å—É–∂–¥–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏
- **–Ø –Ω–∞—á–Ω—É —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π**: —á—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–µ–µ ‚Äî –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏? –û—Ç —ç—Ç–æ–≥–æ –∑–∞–≤–∏—Å—è—Ç –≤—ã–±–æ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–π, LINQ, –∫—ç—à, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.
- **–û–ø–∏—à—É –∫–æ–º–ø—Ä–æ–º–∏—Å—Å—ã**: –≥–¥–µ —É–º–µ—Å—Ç–µ–Ω LINQ, –∞ –≥–¥–µ –ª—É—á—à–µ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–π –∫–æ–¥; –∫–æ–≥–¥–∞ DI-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –æ–ø—Ä–∞–≤–¥–∞–Ω—ã; –≥–¥–µ –∫—ç—à –¥–∞—Å—Ç –≤—ã–∏–≥—Ä—ã—à, –∞ –≥–¥–µ —Å–æ–∑–¥–∞—Å—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å—é.
- **–ü–æ–∫–∞–∂—É –ø—Ä–∞–∫—Ç–∏–∫—É**: –∫–∞–∫ —è –±—ã –Ω–∞–ø–∏—Å–∞–ª, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª –∏ –∑–∞–¥–µ–ø–ª–æ–∏–ª —Ä–µ—à–µ–Ω–∏–µ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–µ—Ç—Ä–∏–∫–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, —Ä–µ—Ç—Ä–∞–∏).

---

## 1) –¢–∏–ø—ã, —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ, –∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, value vs reference

**–ó–∞—á–µ–º:** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–∏—à–Ω–∏—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π –∏ –±–æ–∫–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤.

- **Value vs Reference:**
  - Value-—Ç–∏–ø—ã (struct) —Ö—Ä–∞–Ω—è—Ç—Å—è *–ø–æ –∑–Ω–∞—á–µ–Ω–∏—é*, –∫–æ–ø–∏—Ä—É—é—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º; Reference-—Ç–∏–ø—ã (class) ‚Äî *–ø–æ —Å—Å—ã–ª–∫–µ*, –∞–ª–ª–æ—Ü–∏—Ä—É—é—Ç—Å—è –≤ heap.
  - **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ª–∏—à–Ω–∏–µ –∫–æ–ø–∏–∏ –∫—Ä—É–ø–Ω—ã—Ö `struct` —É—Ö—É–¥—à–∞—é—Ç –ø–µ—Ä—Ñ; –±–æ–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤ `class` —É—Ö—É–¥—à–∞—é—Ç —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å.

- **–ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å (–Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–∏–∑–∞–π–Ω–∞):**
  - –£–ø—Ä–æ—â–∞–µ—Ç –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å, –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ.
  - –î–ª—è –∫–ª–∞—Å—Å–æ–≤ ‚Äî **readonly-—Å–≤–æ–π—Å—Ç–≤–∞**, init-only setters, –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –º—É—Ç–∞—Ü–∏–π.

- **–†–∞–≤–µ–Ω—Å—Ç–≤–æ –∏ —Ö—ç—à-–∫–æ–¥:**
  - –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ **`Equals`/`GetHashCode`** —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `EqualityComparer<T>` –∏ `HashCode.Combine`.
  - –î–ª—è value-–æ–±—ä–µ–∫—Ç–æ–≤ (DDD) –æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –ø–æ –ø–æ–ª—è–º.

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä:** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ + ToString
```csharp
public sealed class Money : IEquatable<Money>
{
    public decimal Amount { get; }
    public string Currency { get; }

    public Money(decimal amount, string currency) =>
        (Amount, Currency) = (amount, currency);

    public override string ToString() => $"{Amount:0.##} {Currency}";

    public bool Equals(Money? other) =>
        other is not null && Amount == other.Amount && Currency == other.Currency;

    public override bool Equals(object? obj) => obj is Money m && Equals(m);
    public override int GetHashCode() => HashCode.Combine(Amount, Currency);
}
```

**–ö–æ–≥–¥–∞ struct —É–º–µ—Å—Ç–µ–Ω:** –º–∞–ª–µ–Ω—å–∫–∏–µ, —á–∞—Å—Ç–æ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ ¬´–∑–Ω–∞—á–µ–Ω–∏—è¬ª, –Ω–∞–ø—Ä–∏–º–µ—Ä –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, –¥–µ–Ω—å–≥–∏ (—Å –æ–≥–æ–≤–æ—Ä–∫–∞–º–∏), –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `readonly struct` –¥–ª—è –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ—Å—Ç–∏.

---

## 2) –ö–æ–ª–ª–µ–∫—Ü–∏–∏ –∏ –≤—ã–±–æ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö

**–ß–∞—Å—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- **List<T>** ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –º–∞—Å—Å–∏–≤; –≤—Å—Ç–∞–≤–∫–∏ –≤ –∫–æ–Ω–µ—Ü O(1), –ø–æ–∏—Å–∫ O(n).
- **Dictionary<TKey,TValue>** ‚Äî –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ O(1) –∞–º–æ—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ; –¥—É–º–∞–π—Ç–µ –æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º `GetHashCode`.
- **HashSet<T>** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–∂–¥–µ–Ω–∏—è O(1), —É–¥–æ–±–Ω–æ –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏.
- **ConcurrentDictionary/Bag/Queue** ‚Äî –¥–ª—è –º—É–ª—å—Ç–∏–ø–æ—Ç–æ—á–Ω–æ—Å—Ç–∏; –Ω–æ –æ—Ü–µ–Ω–∏—Ç–µ contention, –∏–Ω–æ–≥–¥–∞ –±—ã—Å—Ç—Ä–µ–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ + –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ.

**–°–æ–≤–µ—Ç—ã:**
- –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –ª–∏—à–Ω–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π –≤ LINQ-—Ü–µ–ø–æ—á–∫–∞—Ö (`ToList` —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –Ω—É–∂–µ–Ω –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç).
- –î–ª—è —á–∞—Å—Ç–æ–≥–æ ¬´–ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ id¬ª ‚Äî `HashSet<int>`.
- –î–ª—è –±–æ–ª—å—à–∏—Ö –∫–æ–ª–ª–µ–∫—Ü–∏–π –∏ —á–∞—Å—Ç—ã—Ö –≤—Å—Ç–∞–≤–æ–∫ –≤ —Å–µ—Ä–µ–¥–∏–Ω—É ‚Äî –ø–æ–¥—É–º–∞–π—Ç–µ –æ –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö (Queue, LinkedList ‚Äî —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é).

---

## 3) LINQ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (IEnumerable vs IQueryable, –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)

- **–û—Ç–ª–æ–∂–µ–Ω–Ω–æ–µ vs –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ:** LINQ-–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –Ω–∞–¥ `IEnumerable<T>` **–ª–µ–Ω–∏–≤—ã–µ**. –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî `ToList/ToArray/First/Count`.
- **IQueryable**: –≤ EF Core –ø—Ä–æ–≤–∞–π–¥–µ—Ä –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –≤ SQL; **–Ω–µ —Ç–∞—â–∏—Ç–µ** –≤ –ø–∞–º—è—Ç—å —Ç–æ, —á—Ç–æ –º–æ–∂–Ω–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –ë–î.
- **–ü–∞—Ç—Ç–µ—Ä–Ω:** —Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã **–ø–æ—à–∞–≥–æ–≤–æ**, –Ω–æ **–º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É–π—Ç–µ –æ–¥–∏–Ω —Ä–∞–∑** –ø–æ –º–µ—Å—Ç—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

**–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –ø–µ—Ä—Ñ:**
- –ù–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π—Ç–µ –∞–Ω–æ–Ω–∏–º–Ω—ã–º–∏ —Å–ª–æ–∂–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ü–∏—è–º–∏ ‚Äî –ª—É—á—à–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ DTO.
- –î–ª—è ¬´–≥—Ä—É–ø–ø–∏—Ä–æ–≤–æ–∫ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–π¬ª –≤ –ë–î ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `IQueryable` –∏ —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ç—ã.

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä:** –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
```csharp
IQueryable<Order> query = db.Orders.Where(o => o.Status == Status.Active);
if (fromDate is not null) query = query.Where(o => o.Date >= fromDate);
if (toDate   is not null) query = query.Where(o => o.Date <  toDate);
var page = await query
    .OrderByDescending(o => o.Date)
    .Skip((pageIndex-1)*pageSize).Take(pageSize)
    .Select(o => new OrderDto(o.Id, o.Date, o.Total))
    .ToListAsync(ct);
```

---

## 4) Async/await, Task –∏ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º

- **`ConfigureAwait(false)`** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ –±–∏–±–ª–∏–æ—Ç–µ—á–Ω–æ–º/–±—ç–∫–≥—Ä–∞—É–Ω–¥-–∫–æ–¥–µ, –≥–¥–µ –Ω–µ –Ω—É–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:** –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–∑ `Task` –≤—Å–ø–ª—ã–≤—É—Ç –ø—Ä–∏ `await`; **–Ω–µ —Ç–µ—Ä—è–π—Ç–µ** `await` (fire-and-forget —Ç–æ–ª—å–∫–æ –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º).
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è:** `Task.WhenAll` –¥–ª—è –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤; –¥–æ–∑–∏—Ä—É–π—Ç–µ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º —á–µ—Ä–µ–∑ `SemaphoreSlim`.

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä:** –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –ª–∏–º–∏—Ç–æ–º
```csharp
var throttler = new SemaphoreSlim(8);
var tasks = items.Select(async item =>
{
    await throttler.WaitAsync(ct);
    try { return await ProcessAsync(item, ct); }
    finally { throttler.Release(); }
});
var results = await Task.WhenAll(tasks);
```

- **`Task` vs `ValueTask`**: `ValueTask` —É–º–µ–Ω—å—à–∞–µ—Ç –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–∏ *–æ—á–µ–Ω—å* —á–∞—Å—Ç—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ-–∑–∞–≤–µ—Ä—à–∞—é—â–∏—Ö—Å—è –ø—É—Ç—è—Ö; –≤ API –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ª—É—á—à–µ `Task`.

---

## 5) –ò—Å–∫–ª—é—á–µ–Ω–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –≥–ª–æ–±–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

- –õ–æ–≤–∏—Ç–µ **—É–∑–∫–æ** –∏ **–±–ª–∏–∑–∫–æ –∫ –º–µ—Å—Ç—É** –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è; –Ω–µ –≥–ª—É—à–∏—Ç–µ –≤—Å–µ –æ—à–∏–±–∫–∏.
- –í ASP.NET Core:
  - –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ ‚Äî **`UseExceptionHandler`** + –µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫ (problem details).
  - –õ–æ–≥–∏—Ä—É–π—Ç–µ `ex.ToString()` (—Å–æ stack trace), –¥–æ–±–∞–≤–ª—è–π—Ç–µ **–∫–æ–Ω—Ç–µ–∫—Å—Ç** (requestId, userId, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã).
- **–ü–æ–ª–∏—Ç–∏–∫–∏ –ø–æ–≤—Ç–æ—Ä–æ–≤** (retry, timeout, circuit breaker) ‚Äî —á–µ—Ä–µ–∑ Polly –Ω–∞ —É—Ä–æ–≤–Ω–µ HTTP/–ë–î-–∫–ª–∏–µ–Ω—Ç–æ–≤.

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä:** ProblemDetails middleware (–∏–¥–µ—è)
```csharp
app.UseExceptionHandler(builder =>
{
    builder.Run(async ctx =>
    {
        var ex = ctx.Features.Get<IExceptionHandlerFeature>()?.Error;
        var problem = new ProblemDetails
        {
            Status = StatusCodes.Status500InternalServerError,
            Title = "Unexpected error",
            Detail = ex?.Message,
            Instance = ctx.TraceIdentifier
        };
        await Results.Problem(problem).ExecuteAsync(ctx);
    });
});
```

---

## 6) Dependency Injection (–∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã, —Ñ–∞–±—Ä–∏–∫–∏, —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å)

- **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã:** `Transient` (–∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω–æ–≤—ã–π), `Scoped` (–Ω–∞ –∑–∞–ø—Ä–æ—Å), `Singleton` (–Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ). –ù–µ ¬´–ø–æ–¥–Ω–∏–º–∞–π—Ç–µ¬ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–ª—É—á–∞–π–Ω–æ.
- **–ü–∞—Ç—Ç–µ—Ä–Ω—ã:** `Func<T>`/`IServiceProvider` –¥–ª—è —Ñ–∞–±—Ä–∏–∫, **Options** (`IOptions*`) –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π.
- **–°–æ–±–ª—é–¥–∞–π—Ç–µ –≥—Ä–∞–Ω–∏—Ü—ã scoped:** –Ω–µ –∏–Ω–∂–µ–∫—Ç–∏—Ä—É–π—Ç–µ `Scoped` –≤ `Singleton`.
- **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**, –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã ‚Äî –∑–∞ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è–º–∏ (IClock, IDateProvider, ICache).

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä:** —Ñ–∞–±—Ä–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞
```csharp
services.AddHttpClient<IMyApi, MyApi>(client => client.BaseAddress = new Uri(cfg.Url))
        .AddPolicyHandler(PollyPolicies.RetryWithJitter);
```

---

## 7) –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ API, —Ñ–∏–ª—å—Ç—Ä—ã, middleware

- **–ì—Ä–∞–Ω–∏—Ü—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:** –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Ç–æ–Ω–∫–∏–π ‚Üí –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö/—Ö–µ–Ω–¥–ª–µ—Ä–∞—Ö (MediatR ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
- **–§–∏–ª—å—Ç—Ä—ã vs Middleware:** —Ñ–∏–ª—å—Ç—Ä—ã –±–ª–∏–∂–µ –∫ MVC (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –∫—Ä–æ—Å—Å-—Å—Ä–µ–∑—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –¥–µ–π—Å—Ç–≤–∏–π); middleware ‚Äî **—Å–∫–≤–æ–∑–Ω—ã–µ** –≤–µ—â–∏ (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –∫–æ—Ä–µ–ª—è—Ü–∏–∏, CORS).
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ API** —É–º–µ—Å—Ç–Ω—ã –¥–ª—è –ª—ë–≥–∫–∏—Ö –µ–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤, –≥–¥–µ MVC –∏–∑–±—ã—Ç–æ—á–µ–Ω.

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä:** –ø–∞–≥–∏–Ω–∞—Ü–∏—è + —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
```csharp
[HttpGet]
public async Task<PagedResult<OrderDto>> Get([FromQuery] OrderQuery q, CancellationToken ct)
{
    var baseQuery = repo.QueryActive();
    if (!string.IsNullOrWhiteSpace(q.Search))
        baseQuery = baseQuery.Where(o => o.Number.Contains(q.Search));
    var total = await baseQuery.CountAsync(ct);
    var items = await baseQuery.OrderByDescOrAsc(q.SortBy, q.Desc)
                               .Skip(q.Skip).Take(q.Take)
                               .ProjectToDto()
                               .ToListAsync(ct);
    return new(items, total);
}
```

---

## 8) HttpClientFactory + Polly

- **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–∫–µ—Ç–æ–≤, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥, –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **Typed/Named clients**, –¥–æ–±–∞–≤–ª—è–π—Ç–µ **retry/timeout/breaker**.
- –ù–µ –∑–∞–±—É–¥—å—Ç–µ **–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ –∏ **–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—é** (trace id).

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä:** —Ç–∞–π–º–∞—É—Ç + –ø–æ–≤—Ç–æ—Ä
```csharp
services.AddHttpClient("billing", c => c.BaseAddress = new Uri(cfg.BillingUrl))
    .AddTransientHttpErrorPolicy(p => p.WaitAndRetryAsync(3, i => TimeSpan.FromMilliseconds(200 * i)))
    .AddPolicyHandler(Policy.TimeoutAsync<HttpResponseMessage>(TimeSpan.FromSeconds(5)));
```

---

## 9) BackgroundService, —Ç–∞–π–º–µ—Ä—ã, –æ—Ç–º–µ–Ω–∞

- –î–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `BackgroundService` + `PeriodicTimer`.
- –ü—Ä–æ–ø–∏—Ö–∏–≤–∞–π—Ç–µ **`CancellationToken`** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö, –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å –ª–æ–≥–∏–∫–æ–π –ø–æ–≤—Ç–æ—Ä–æ–≤.
- –õ–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, idempotency (–Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ —Å–æ–±—ã—Ç–∏–µ –¥–≤–∞–∂–¥—ã).

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä:**
```csharp
public sealed class CleanupService : BackgroundService
{
    private readonly PeriodicTimer _timer = new(TimeSpan.FromMinutes(5));
    protected override async Task ExecuteAsync(CancellationToken ct)
    {
        while (await _timer.WaitForNextTickAsync(ct))
        {
            await DoCleanupAsync(ct); // try/catch + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏
        }
    }
}
```

---

## 10) GC –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é (–¥–ª—è Middle)

**–ß—Ç–æ –∑–Ω–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏:**
- **–ü–æ–∫–æ–ª–µ–Ω–∏—è GC:** Gen0, Gen1, Gen2; —á–∞—Å—Ç—ã–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã —É–º–∏—Ä–∞—é—Ç –≤ Gen0; –¥–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ ‚Äî –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –¥–æ Gen2.
- **LOH (Large Object Heap):** –∫—Ä—É–ø–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã (85+ KB) –ø–æ–ø–∞–¥–∞—é—Ç –≤ LOH; —Å–±–æ—Ä–∫–∏ —Ä–µ–∂–µ, —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Ä–æ–∂–µ. –ò–∑–±–µ–≥–∞–π—Ç–µ —á–∞—Å—Ç—ã—Ö –±–æ–ª—å—à–∏—Ö –∞–ª–ª–æ–∫–∞—Ü–∏–π/–∫–æ–ø–∏–π.
- **–ö–æ–≥–¥–∞ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è GC:** –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –ø–∞–º—è—Ç–∏, –∞–ª–ª–æ–∫–∞—Ü–∏—è—Ö, —Ä—É—á–Ω–æ–º –≤—ã–∑–æ–≤–µ (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è), —Ñ–æ–Ω–æ–≤—ã–µ —Å–±–æ—Ä–∫–∏ –≤ Server/Workstation —Ä–µ–∂–∏–º–∞—Ö.
- **Async/allocations:** –Ω–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –ª–∏—à–Ω–∏—Ö –∑–∞–º—ã–∫–∞–Ω–∏–π/–∏—Ç–µ—Ä–∞—Ç–æ—Ä–æ–≤, –∏–∑–±–µ–≥–∞–π—Ç–µ –±–æ–∫–æ–≤–æ–≥–æ `ToList()`; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—É–ª—ã (`ArrayPool`/–æ–±—ä–µ–∫—Ç–Ω—ã–µ –ø—É–ª—ã) –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

**–¢–∏–ø–æ–≤—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —É—Ç–µ—á–µ–∫:**
- –î–æ–ª–≥–æ–∂–∏–≤—É—â–∏–µ —Å—Ç–∞—Ç–∏–∫–∏/–∫–µ—à–∏, —É–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã; –Ω–µ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (event handler —É—Ç–µ—á–∫–∏); —Ç–∞–π–º–µ—Ä—ã, –Ω–µ –æ—á–∏—â–µ–Ω–Ω—ã–µ `IDisposable`.
- –ó–∞–º—ã–∫–∞–Ω–∏—è, –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–µ ¬´—Ç–æ–ª—Å—Ç—ã–µ¬ª –∫–æ–Ω—Ç–µ–∫—Å—Ç—ã.

**–ü—Ä–∞–∫—Ç–∏–∫–∞:**
- –ü—Ä–æ—Ñ–∏–ª–∏—Ä—É–π—Ç–µ (dotMemory, PerfView), —Å–º–æ—Ç—Ä–∏—Ç–µ **alloc flame graph**.
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **`using`/`await using`** –¥–ª—è `IDisposable/IAsyncDisposable`.
- –ù–µ –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª—è–π—Ç–µ `string` –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–µ–π –≤ —Ü–∏–∫–ª–∞—Ö ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `StringBuilder` –∏–ª–∏ –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—é –≤–Ω–µ ¬´–≥–æ—Ä—è—á–∏—Ö¬ª –ø—É—Ç–µ–π.
- –ü–æ–¥—É–º–∞–π—Ç–µ –æ **`ReadOnlySpan<T>`**/**`Memory<T>`** –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞/—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ ¬´—É–∑–∫–∏—Ö¬ª –º–µ—Å—Ç–∞—Ö, –Ω–æ –±–µ–∑ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

**–ú–∏–Ω–∏-—á–µ–∫–ª–∏—Å—Ç –ø–æ –ø–∞–º—è—Ç–∏:**
- –ò–∑–±–µ–≥–∞—é –±–æ–ª—å—à–∏—Ö –∫—Ä–∞—Ç–∫–æ–∂–∏–≤—É—â–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ ‚Üí LOH.
- –ù–µ –¥–µ—Ä–∂—É —Å—Å—ã–ª–∫–∏ –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∫—ç—à–∞—Ö ¬´–Ω–∞–≤—Å–µ–≥–¥–∞¬ª ‚Üí TTL/Size cap.
- –ó–∞–∫—Ä—ã–≤–∞—é –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ —Å–æ–±—ã—Ç–∏—è/Timers/HttpResponseMessage/Streams.
- –ù–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É—é LINQ –±–µ–∑ –Ω—É–∂–¥—ã.

---

## 11) IDisposable / IAsyncDisposable –∏ –ø–∞—Ç—Ç–µ—Ä–Ω Dispose

**–ö–æ–≥–¥–∞ –Ω—É–∂–µ–Ω —Ñ–∏–Ω–∞–ª–∞–π–∑–µ—Ä:** –∫–æ–≥–¥–∞ –≤–ª–∞–¥–µ–µ—Ç–µ **–Ω–µ—É–ø—Ä–∞–≤–ª—è–µ–º—ã–º —Ä–µ—Å—É—Ä—Å–æ–º** –Ω–∞–ø—Ä—è–º—É—é (handle, native buffer). –ò–Ω–∞—á–µ ‚Äî –∏–∑–±–µ–≥–∞–π—Ç–µ —Ñ–∏–Ω–∞–ª–∞–π–∑–µ—Ä–∞, –æ–Ω –¥–æ—Ä–æ–≥.

**–®–∞–±–ª–æ–Ω:**
```csharp
public class ResourceHolder : IDisposable, IAsyncDisposable
{
    private bool _disposed;
    private readonly Stream _stream;
    public ResourceHolder(Stream stream) => _stream = stream;

    public void Dispose()
    {
        if (_disposed) return;
        _disposed = true;
        _stream.Dispose();
        GC.SuppressFinalize(this);
    }

    public async ValueTask DisposeAsync()
    {
        if (_disposed) return;
        _disposed = true;
        await _stream.DisposeAsync();
        GC.SuppressFinalize(this);
    }
}
```

---

## 12) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ Options

- –ú—ç–ø–ø—å—Ç–µ —Å–µ–∫—Ü–∏–∏ –≤ `record`-—Ç–∏–ø—ã, –≤–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.
- –û—Ç–ª–∏—á–∏—è: **`IOptions`** (—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ), **`IOptionsSnapshot`** (scoped-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ), **`IOptionsMonitor`** (–ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è).

**–ú–∏–Ω–∏-–ø—Ä–∏–º–µ—Ä:**
```csharp
builder.Services.AddOptions<StorageOptions>()
    .Bind(builder.Configuration.GetSection("Storage"))
    .ValidateDataAnnotations()
    .Validate(o => Uri.IsWellFormedUriString(o.Endpoint, UriKind.Absolute), "Endpoint must be URL")
    .ValidateOnStart();
```

---

## 13) –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (ILogger/NLog/Serilog –∏–¥–µ–∏)

- **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –ª–æ–≥–∏:** –Ω–µ —Å—Ç—Ä–æ–∫–∞, –∞ –ø–æ–ª—è: `logger.LogInformation("User {UserId} created order {OrderId}", userId, orderId)`.
- –£—Ä–æ–≤–Ω–∏ –∏ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ —Å—Ä–µ–¥–∞–º; –∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è `X-Request-ID`.
- –õ–æ–≥–∏—Ä—É–π—Ç–µ **–∫–ª—é—á–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è**, –æ—à–∏–±–∫–∏ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, –Ω–æ –∏–∑–±–µ–≥–∞–π—Ç–µ ¬´—à—É–º–æ–≤—ã—Ö¬ª –ª–æ–≥–æ–≤.

---

## 14) –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã (–∫—Ä–∞—Ç–∫–æ)

- **CQRS (–≤–Ω—É—Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–∞):** –∫–æ–º–∞–Ω–¥—ã/–∑–∞–ø—Ä–æ—Å—ã ‚Üí —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å.
- **Specification / Predicate builder** –¥–ª—è –∫–æ–º–ø–æ–∑–∏—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ EF/Dapper.
- **Policy-–æ–±—ë—Ä—Ç–∫–∏** –≤–æ–∫—Ä—É–≥ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö –≤—ã–∑–æ–≤–æ–≤.
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ¬´–Ω–∞ –∫—Ä–∞—è—Ö¬ª (HTTP/Redis) –¥–ª—è read-heavy —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Å TTL.

---

## 15) –ö–æ—Ä–æ—Ç–∫–∏–π —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —Å–ø–∏—Å–æ–∫ (–ø–µ—Ä–µ–¥ –∏–Ω—Ç–µ—Ä–≤—å—é)

- –ú–æ–≥—É –æ–±—ä—è—Å–Ω–∏—Ç—å —Ä–∞–∑–Ω–∏—Ü—É `IEnumerable` vs `IQueryable` –∏ –≥–¥–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É—é.
- –ó–Ω–∞—é, –∫–∞–∫ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å **–æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** (ProblemDetails) + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.
- –£–º–µ—é –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `HttpClientFactory` —Å Polly –∏ **–æ–±—ä—è—Å–Ω–∏—Ç—å** –ø–æ–ª–∏—Ç–∏–∫–∏.
- –ü–æ–Ω–∏–º–∞—é **–ø–æ–∫–æ–ª–µ–Ω–∏—è GC, LOH –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ —É—Ç–µ—á–µ–∫** –≤ .NET.
- –ú–æ–≥—É —É–≤–µ—Ä–µ–Ω–Ω–æ –≥–æ–≤–æ—Ä–∏—Ç—å –ø—Ä–æ **DI-–∂–∏–∑–Ω–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã** –∏ scoped-–≥—Ä–∞–Ω–∏—Ü—ã.
- –ü–æ–Ω–∏–º–∞—é, –≥–¥–µ —Ñ–∏–ª—å—Ç—Ä—ã, –≥–¥–µ middleware, –≥–¥–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ API.
- –ó–Ω–∞—é, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É, –Ω–µ —Ç–µ—Ä—è—è `await` –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å.
