
# –ü—Ä–∏–Ω—Ü–∏–ø—ã ACID –≤ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî –ü–æ–¥—Ä–æ–±–Ω–æ –¥–ª—è Middle

## üéØ –ö–∞–∫ —Ä–∞—Å—Å—É–∂–¥–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏

> ‚ÄúACID ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä —Å–≤–æ–π—Å—Ç–≤, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∏—Ö –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –≤ –°–£–ë–î. –≠—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö, —Å–±–æ—è—Ö –∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –¥–æ—Å—Ç—É–ø–µ.‚Äù

---

## üîπ –ß—Ç–æ —Ç–∞–∫–æ–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è

**–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è** ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–π, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã—Ö –∫–∞–∫ –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ.  
–õ–∏–±–æ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —É—Å–ø–µ—à–Ω–æ, –ª–∏–±–æ **–æ—Ç–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è** (rollback).

**–ü—Ä–∏–º–µ—Ä:**
```sql
BEGIN TRANSACTION

UPDATE Accounts SET Balance = Balance - 100 WHERE Id = 1;
UPDATE Accounts SET Balance = Balance + 100 WHERE Id = 2;

COMMIT TRANSACTION
```

–ï—Å–ª–∏ –≤—Ç–æ—Ä–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç–∏—Ç—Å—è ‚Äî –±–∞–ª–∞–Ω—Å –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è.

---

## üîπ ACID ‚Äî —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞

| –ü—Ä–∏–Ω—Ü–∏–ø | –ù–∞–∑–≤–∞–Ω–∏–µ | –°—É—Ç—å |
|----------|-----------|------|
| **A** | **Atomicity (–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å)** | –í—Å—ë –∏–ª–∏ –Ω–∏—á–µ–≥–æ |
| **C** | **Consistency (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å)** | –ü–æ—Å–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ |
| **I** | **Isolation (–ò–∑–æ–ª—è—Ü–∏—è)** | –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –º–µ—à–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É |
| **D** | **Durability (–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å)** | –ü–æ—Å–ª–µ `COMMIT` –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è, –¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ–µ |

---

## üß© 1. Atomicity (–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å)

**‚Äú–õ–∏–±–æ –≤—Å—ë, –ª–∏–±–æ –Ω–∏—á–µ–≥–æ.‚Äù**  
–ï—Å–ª–∏ –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ —É–¥–∞–ª–∞—Å—å, –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–º–µ–Ω—è—é—Ç—Å—è.

**–ü—Ä–∏–º–µ—Ä (SQL Server):**
```sql
BEGIN TRANSACTION
UPDATE Accounts SET Balance = Balance - 500 WHERE Id = 1;
UPDATE Accounts SET Balance = Balance + 500 WHERE Id = 2;
IF @@ERROR <> 0
    ROLLBACK TRANSACTION;
ELSE
    COMMIT TRANSACTION;
```

**–í .NET (EF Core):**
```csharp
using var transaction = await context.Database.BeginTransactionAsync();
try
{
    sender.Balance -= 500;
    receiver.Balance += 500;
    await context.SaveChangesAsync();
    await transaction.CommitAsync();
}
catch
{
    await transaction.RollbackAsync();
}
```

---

## üß© 2. Consistency (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å)

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ **–¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –≤–∞–ª–∏–¥–Ω—ã–º–∏**.  
–¢–æ –µ—Å—Ç—å –≤—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (primary key, foreign key, check, unique) –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è.

–ü—Ä–∏–º–µ—Ä –Ω–∞—Ä—É—à–µ–Ω–∏—è:  
–ï—Å–ª–∏ —Å–ø–∏—Å–∞—Ç—å –¥–µ–Ω—å–≥–∏ —Å –æ–¥–Ω–æ–≥–æ —Å—á—ë—Ç–∞, –Ω–æ –Ω–µ –∑–∞—á–∏—Å–ª–∏—Ç—å –Ω–∞ –¥—Ä—É–≥–æ–π ‚Äî –±–∞–ª–∞–Ω—Å –Ω–∞—Ä—É—à–µ–Ω.  

**–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è:**
- –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞–º–∏ (–ª–æ–≥–∏–∫–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è);
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –ë–î (constraints, triggers);
- –¢–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ö–µ–º–æ–π.

**EF Core –ø–æ–º–æ–≥–∞–µ—Ç:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (`[Required]`, `[MaxLength]`, `[ForeignKey]`);
- –í–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –ø–µ—Ä–µ–¥ `SaveChanges()`.

---

## üß© 3. Isolation (–ò–∑–æ–ª—è—Ü–∏—è)

**–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –º–µ—à–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥—É.**  
–ù–∞–ø—Ä–∏–º–µ—Ä, –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –ø–æ–∫–∞ –¥—Ä—É–≥–æ–π –∏—Ö –∏–∑–º–µ–Ω—è–µ—Ç.

SQL Server –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏**:

| –£—Ä–æ–≤–µ–Ω—å | –ß—Ç–æ –¥–æ–ø—É—Å–∫–∞–µ—Ç | –ß—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç |
|----------|----------------|-------------------|
| **Read Uncommitted** | –≥—Ä—è–∑–Ω—ã–µ —á—Ç–µ–Ω–∏—è | ‚Äî |
| **Read Committed** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) | –±–ª–æ–∫–∏—Ä—É–µ—Ç ‚Äú–≥—Ä—è–∑–Ω—ã–µ‚Äù —á—Ç–µ–Ω–∏—è | –¥–æ–ø—É—Å–∫–∞–µ—Ç –Ω–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–µ —á—Ç–µ–Ω–∏—è |
| **Repeatable Read** | –∑–∞–ø—Ä–µ—â–∞–µ—Ç –Ω–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–µ —á—Ç–µ–Ω–∏—è | –¥–æ–ø—É—Å–∫–∞–µ—Ç —Ñ–∞–Ω—Ç–æ–º–Ω—ã–µ |
| **Serializable** | –ø–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è (–º–µ–¥–ª–µ–Ω–Ω–æ) | –≤—Å–µ –∞–Ω–æ–º–∞–ª–∏–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã |
| **Snapshot** | –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫ (–±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫) | –≤—ã—Å–æ–∫–∞—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å |

**–ü—Ä–∏–º–µ—Ä –≤ SQL:**
```sql
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
BEGIN TRANSACTION
SELECT * FROM Orders WHERE Amount > 1000;
WAITFOR DELAY '00:00:05';
COMMIT TRANSACTION;
```

–í —ç—Ç–æ –≤—Ä–µ–º—è –¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –Ω–µ —Å–º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ –∂–µ —Å—Ç—Ä–æ–∫–∏.

**–í EF Core:**
```csharp
await using var tx = await context.Database.BeginTransactionAsync(IsolationLevel.Serializable);
```

---

## üß© 4. Durability (–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å)

–ü–æ—Å–ª–µ `COMMIT` –¥–∞–Ω–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏:
- —Å–±–æ–µ –ø–∏—Ç–∞–Ω–∏—è,
- –ø–∞–¥–µ–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞,
- –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ë–î.

**SQL Server** –∏ –¥—Ä—É–≥–∏–µ –°–£–ë–î –∏—Å–ø–æ–ª—å–∑—É—é—Ç:
- **–∂—É—Ä–Ω–∞–ª —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π (transaction log)** ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º;
- **Write-Ahead Logging (WAL)** ‚Äî –ø—Ä–∏–Ω—Ü–∏–ø ‚Äú—Å–Ω–∞—á–∞–ª–∞ –ª–æ–≥, –ø–æ—Ç–æ–º –¥–∞–Ω–Ω—ã–µ‚Äù;
- **fsync/flush** ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ –¥–∏—Å–∫.

–ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –ø–∞–¥–∞–µ—Ç –ø–æ—Å–ª–µ `COMMIT`, –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ SQL Server –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –∂—É—Ä–Ω–∞–ª–∞.

---

## üîπ –ù–∞—Ä—É—à–µ–Ω–∏—è –∏–∑–æ–ª—è—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ—Ä—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –ü—Ä–∏–º–µ—Ä | –†–µ—à–µ–Ω–∏–µ |
|-----------|---------|----------|
| **Dirty Read** | –æ–¥–Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è —á–∏—Ç–∞–µ—Ç –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–π | Read Committed |
| **Non-repeatable Read** | –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º —á—Ç–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å | Repeatable Read |
| **Phantom Read** | –º–µ–∂–¥—É —á—Ç–µ–Ω–∏—è–º–∏ –¥–æ–±–∞–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ | Serializable / Snapshot |

---

## üîπ –ü—Ä–∏–º–µ—Ä –∞–Ω–æ–º–∞–ª–∏–π

**Dirty Read:**
```sql
-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1
BEGIN TRANSACTION
UPDATE Accounts SET Balance = Balance - 100 WHERE Id = 1;
-- (–µ—â—ë –Ω–µ COMMIT)

-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 2
SELECT Balance FROM Accounts WHERE Id = 1; -- –≤–∏–¥–∏—Ç -100 (–≥—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ)
```

**–†–µ—à–µ–Ω–∏–µ:**
```sql
SET TRANSACTION ISOLATION LEVEL READ COMMITTED;
```

---

## üîπ ACID –∏ EF Core

EF Core –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç **A, C, D**.  
–ò–∑–æ–ª—è—Ü–∏—é –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å —á–µ—Ä–µ–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

**EF Core –ø—Ä–∏–º–µ—Ä:**
```csharp
await using var tx = await context.Database.BeginTransactionAsync(IsolationLevel.ReadCommitted);

await context.SaveChangesAsync();
await tx.CommitAsync();
```

EF —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **distributed transactions** (—á–µ—Ä–µ–∑ `TransactionScope`) ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

```csharp
using (var scope = new TransactionScope(TransactionScopeAsyncFlowOption.Enabled))
{
    await db1.SaveChangesAsync();
    await db2.SaveChangesAsync();
    scope.Complete();
}
```

---

## üîπ ACID –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö

| –°—Ü–µ–Ω–∞—Ä–∏–π | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ |
|-----------|-------------|
| **–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** | —Å—Ç—Ä–æ–≥–∞—è ACID ‚Äî –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã |
| **E-commerce –∫–æ—Ä–∑–∏–Ω–∞** | –¥–æ–ø—É—Å—Ç–∏–º–æ –æ—Å–ª–∞–±–∏—Ç—å –∏–∑–æ–ª—è—Ü–∏—é (Read Committed) |
| **–û—á–µ—Ä–µ–¥–∏ —Å–æ–æ–±—â–µ–Ω–∏–π** | —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç eventual consistency |
| **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã** | ACID –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞, –∞ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ ‚Äî Saga / Outbox |

---

## üîπ ACID vs BASE

| –°–≤–æ–π—Å—Ç–≤–æ | ACID | BASE |
|-----------|-------|------|
| –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å | –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è | —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º |
| –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ | –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ SQL –ë–î | —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ NoSQL —Å–∏—Å—Ç–µ–º—ã |
| –ì–∞—Ä–∞–Ω—Ç–∏–∏ | —Å—Ç—Ä–æ–≥–∏–µ | –≥–∏–±–∫–∏–µ |
| –ü—Ä–∏–º–µ—Ä | SQL Server, PostgreSQL | Cassandra, MongoDB |

---

## üîπ –ö–ª—é—á–µ–≤—ã–µ —Ç–µ–∑–∏—Å—ã –¥–ª—è –∏–Ω—Ç–µ—Ä–≤—å—é

- **A (Atomicity):** —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Äî –µ–¥–∏–Ω–æ–µ —Ü–µ–ª–æ–µ, rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ.  
- **C (Consistency):** –¥–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏.  
- **I (Isolation):** –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–µ –º–µ—à–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥—É.  
- **D (Durability):** –ø–æ—Å–ª–µ commit –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è.  
- EF Core –∏ SQL Server —Ä–µ–∞–ª–∏–∑—É—é—Ç –≤—Å–µ —á–µ—Ç—ã—Ä–µ —Å–≤–æ–π—Å—Ç–≤–∞.  
- –í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å **—É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏** –∏ **trade-offs –º–µ–∂–¥—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é**.
