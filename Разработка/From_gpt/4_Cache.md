
# –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ Redis ‚Äî Middle

### üéØ –ö–∞–∫ —Ä–∞—Å—Å—É–∂–¥–∞—Ç—å –Ω–∞ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–∏
- **–ù–∞—á–∏–Ω–∞—é —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:** —á—Ç–æ –∫—ç—à–∏—Ä—É–µ–º ‚Äî –æ–±—ä–µ–∫—Ç—ã, –∑–∞–ø—Ä–æ—Å—ã, —Å—Ç—Ä–∞–Ω–∏—Ü—ã?  
- **–ü–æ–∫–∞–∑—ã–≤–∞—é –ø–æ–Ω–∏–º–∞–Ω–∏–µ:** –∫—ç—à ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —É—Å–∫–æ—Ä–µ–Ω–∏–µ, –∞ –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É —Å–∫–æ—Ä–æ—Å—Ç—å—é –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å—é.  
- **–†–∞—Å—Å–∫–∞–∑—ã–≤–∞—é –ø—Ä–æ –ø–æ–¥—Ö–æ–¥:** TTL, invalidation, Cache-Aside, –º–µ—Ç—Ä–∏–∫–∏.  

---

## 1) –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

- **–ó–∞—á–µ–º –∫—ç—à:** —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ë–î –∏ —Å–µ—Ç—å, —É—Å–∫–æ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç—ã, —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –ø—Ä–∏ –ø–∏–∫–∞—Ö.  
- **–ö–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å:** –ø—Ä–∏ —á–∞—Å—Ç–æ –º–µ–Ω—è—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö, —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –∫ –∑–∞–¥–µ—Ä–∂–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∏–ª–∏ –ø—Ä–∏ –≤—ã—Å–æ–∫–∏—Ö —Ä–∏—Å–∫–∞—Ö —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

**–¢–∏–ø—ã –∫—ç—à–∞:**
- **–õ–æ–∫–∞–ª—å–Ω—ã–π (MemoryCache)** ‚Äî –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–æ—Ü–µ—Å—Å–∞, –±—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ –¥–µ–ª—è—Ç—Å—è –º–µ–∂–¥—É –∏–Ω—Å—Ç–∞–Ω—Å–∞–º–∏.
- **–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π (Redis, Memcached)** ‚Äî –æ–±—â–∏–π –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤, —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è.

---

## 2) TTL –∏ Sliding Expiration

- **TTL (Time-To-Live):** —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –∫–ª—é—á–∞. –ü–æ—Å–ª–µ –∏—Å—Ç–µ—á–µ–Ω–∏—è ‚Äî –∫–ª—é—á —É–¥–∞–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
- **Sliding Expiration:** –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏.  
  –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ä–µ–¥–∫–æ —á–∏—Ç–∞–µ–º—ã—Ö, –Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–ü—Ä–∏–º–µ—Ä (MemoryCache):**
```csharp
cache.Set("users", users, new MemoryCacheEntryOptions
{
    SlidingExpiration = TimeSpan.FromMinutes(10)
});
```

---

## 3) –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

| –°—Ç—Ä–∞—Ç–µ–≥–∏—è | –°—É—Ç—å | –ü—Ä–∏–º–µ—Ä |
|------------|------|---------|
| **Cache-Aside** | —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø—Ä–æ—Å –≤ –∫—ç—à, –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –±–µ—Ä—ë–º –∏–∑ –ë–î –∏ –∫–ª–∞–¥—ë–º –≤ –∫—ç—à | —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è Redis |
| **Write-Through** | –∑–∞–ø–∏—Å—å —Å—Ä–∞–∑—É –∏ –≤ –∫—ç—à, –∏ –≤ –ë–î | —Å–ª–æ–∂–Ω–µ–µ, –Ω–æ –º–µ–Ω—å—à–µ –ø—Ä–æ–º–∞—Ö–æ–≤ |
| **Read-Through** | –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–Ω–∞–µ—Ç –ø—Ä–æ –∫—ç—à ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –±–µ—Ä—ë—Ç –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ | —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ .NET |
| **Refresh-Ahead** | –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞—Ä–∞–Ω–µ–µ –ø–µ—Ä–µ–¥ –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º TTL | –¥–ª—è ‚Äú–≥–æ—Ä—è—á–∏—Ö‚Äù –∫–ª—é—á–µ–π |

**Cache-Aside –ø—Ä–∏–º–µ—Ä:**
```csharp
var data = await cache.GetAsync<User>("user:1");
if (data is null)
{
    data = await db.Users.FindAsync(1);
    await cache.SetAsync("user:1", data, TimeSpan.FromMinutes(5));
}
```

---

## 4) –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞

**–ó–∞—á–µ–º:** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö.  

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
- **Manual** ‚Äî —Å–±—Ä–æ—Å –≤—Ä—É—á–Ω—É—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.
- **Time-based (TTL)** ‚Äî –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞.
- **Tag-based** ‚Äî —Å–±—Ä–æ—Å –ø–æ –≥—Ä—É–ø–ø–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—Å–µ –±—Ä–µ–Ω–¥—ã –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞).
- **Version-based (cache busting)** ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `promo:v2:123`).

**–ü—Ä–∏–º–µ—Ä tag-based:**
```csharp
var keys = redis.GetKeysByPattern("brand:region:12:*");
foreach (var key in keys)
    await redis.DelAsync(key);
```

---

## 5) Cache Stampede (–∞—Ç–∞–∫–∞ –Ω–∞ –∫—ç—à)

**–ü—Ä–æ–±–ª–µ–º–∞:** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –º–Ω–æ–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∫ –∏—Å—Ç—ë–∫—à–µ–º—É –∫–ª—é—á—É ‚Üí –ª–∞–≤–∏–Ω–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –ë–î.  

**–†–µ—à–µ–Ω–∏—è:**
- **Locking:** –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –±–ª–æ–∫–∏—Ä—É–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è.
- **Jitter:** –¥–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Å–¥–≤–∏–≥ TTL, —á—Ç–æ–±—ã –∫–ª—é—á–∏ –Ω–µ –∏—Å—Ç–µ–∫–∞–ª–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.
- **Double-checked caching:** –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é.

**–ü—Ä–∏–º–µ—Ä —Å Jitter:**
```csharp
var ttl = TimeSpan.FromMinutes(5) + TimeSpan.FromSeconds(Random.Shared.Next(0, 30));
await redis.SetAsync("key", value, ttl);
```

---

## 6) –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
- **Cache hit ratio** ‚Äî –ø—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫—ç—à.
- **Miss ratio** ‚Äî –¥–æ–ª—è –ø—Ä–æ–º–∞—Ö–æ–≤.
- **Eviction count** ‚Äî —á–∏—Å–ª–æ —É–¥–∞–ª–µ–Ω–∏–π –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏.

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- Prometheus + Grafana.
- Redis –∫–æ–º–∞–Ω–¥–æ–π `INFO stats` ‚Üí —Å–º–æ—Ç—Ä–∏–º `keyspace_hits`, `keyspace_misses`.

---

## 7) Redis ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

| –ö–æ–º–∞–Ω–¥–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|----------|-------------|
| `SET key value EX 60` | –∑–∞–ø–∏—Å–∞—Ç—å —Å TTL |
| `GET key` | –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ |
| `DEL key` | —É–¥–∞–ª–∏—Ç—å |
| `EXISTS key` | –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ |
| `INCR/DECR key` | —É–≤–µ–ª–∏—á–∏—Ç—å/—É–º–µ–Ω—å—à–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ |
| `MGET/MSET` | –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| `HSET/HGET/HGETALL` | —Ä–∞–±–æ—Ç–∞ —Å hash |
| `LPUSH/RPUSH/LRANGE` | —Å–ø–∏—Å–∫–∏ |
| `SADD/SMEMBERS` | –º–Ω–æ–∂–µ—Å—Ç–≤–∞ |
| `ZADD/ZRANGE` | —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ |

---

## 8) –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö Redis ‚Äî –∫—Ä–∞—Ç–∫–æ

| –¢–∏–ø | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|------|---------------------|
| **String** | –∫—ç—à JSON-–æ–±—ä–µ–∫—Ç–æ–≤, —Ç–æ–∫–µ–Ω—ã |
| **Hash** | —Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–Ω—ã—Ö —Å–≤–æ–π—Å—Ç–≤ (User: {Id, Name}) |
| **List** | –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á |
| **Set** | —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∞–∫—Ç–∏–≤–Ω—ã–µ —é–∑–µ—Ä—ã) |
| **SortedSet (ZSET)** | —Ä–µ–π—Ç–∏–Ω–≥–∏, –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã |

**–ü—Ä–∏–º–µ—Ä Hash:**
```bash
HSET user:100 name "Alice" age "29"
HGETALL user:100
```

---

## 9) –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** (–ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã) –≤ –∫—ç—à–µ.  
- –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ Redis –ø–∞—Ä–æ–ª–µ–º (`requirepass`) –∏ —Å–µ—Ç–µ–≤—ã–º–∏ ACL.  
- –†–∞–∑–¥–µ–ª—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π –ø–æ namespace (`prod:`, `test:`).  
- –î–ª—è multi-tenant —Å–∏—Å—Ç–µ–º ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã (`user:{id}:...`).

---

## 10) –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis

### Pub/Sub
- –î–ª—è —Å–æ–±—ã—Ç–∏–π –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏.
```bash
SUBSCRIBE updates
PUBLISH updates "user:42 changed"
```

### Distributed Lock (SET NX PX)
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –≥–æ–Ω–æ–∫ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫—ç—à–∞.
```bash
SET lock:promo true NX PX 5000
DEL lock:promo
```

### Streams
- –û—á–µ—Ä–µ–¥–∏ —Å–æ–±—ã—Ç–∏–π (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ Kafka –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∫–µ–π—Å–æ–≤).
```bash
XADD queue * user 42 action "login"
XREAD COUNT 10 STREAMS queue 0
```

---

## 11) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω–æ–≥–æ –∫—ç—à–∞

- **L1 (MemoryCache)** ‚Üí –±—ã—Å—Ç—Ä—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å.  
- **L2 (Redis)** ‚Üí –æ–±—â–∏–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –∫—ç—à.  

**–ê–ª–≥–æ—Ä–∏—Ç–º:** —Å–Ω–∞—á–∞–ª–∞ –∏—â–µ–º –≤ L1, –ø—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ L2 –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –æ–±–∞ —É—Ä–æ–≤–Ω—è.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** –º–µ–Ω—å—à–µ —Å–µ—Ç–µ–≤—ã—Ö –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ Redis, –Ω–æ —Ä–∏—Å–∫ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

---

## 12) –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —á–µ–∫–ª–∏—Å—Ç

‚úÖ –ß—Ç–æ –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å middle:
- –û–±—ä—è—Å–Ω–∏—Ç—å —Ä–∞–∑–Ω–∏—Ü—É MemoryCache vs Redis.  
- –†–∞—Å—Å–∫–∞–∑–∞—Ç—å –ø—Ä–æ TTL –∏ sliding expiration.  
- –û–±—ä—è—Å–Ω–∏—Ç—å Cache-Aside –∏ invalidation.  
- –ó–Ω–∞—Ç—å –ø—Ä–æ Cache Stampede –∏ Jitter.  
- –£–º–µ—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å Redis –∏ —á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.  
- –ü–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Pub/Sub –∏ Distributed Lock.  
- –ó–Ω–∞—Ç—å, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫—ç—à.  
